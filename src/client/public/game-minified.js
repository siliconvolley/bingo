(()=>{var E=document.querySelector("#shareScreen"),p=document.querySelector("#randomButton"),$=document.querySelector("#user-grid"),Y=$.childNodes,m=document.querySelector("#playButton"),u=document.querySelector("#grid"),D=u.childNodes,N=document.querySelector("body"),y=document.querySelector("#endScreen"),J=document.querySelector("#usernameOkButton"),K=document.querySelector("#usernameInput"),G=document.querySelector("#promptScreen"),U=document.querySelector("#shareCode"),X=document.querySelector("#shareLink"),z=document.querySelector("#shareCloseButton"),T=y.querySelector("#winnerText");var i=class{constructor(t,r){this.event=t,this.data=r}event;data};var h=class extends i{constructor(t){super("request",t)}};var x=class extends i{constructor(t){super("start",t)}};var S=class extends i{constructor(t){super("ready",t)}};var v=class extends i{constructor(t){super("choice",t)}};var k=class extends i{constructor(t){super("completed",t)}};function W(e){return e.style.display=="none"}function c(e){e.style.display=""}function l(e){e.style.display="none"}function Q(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function C(e,t){let r=Object.keys(t)[0];return document.querySelector(`${e}[${r}="${t[r]}"]`)}function V({name:e,id:t,status:r}){let n=document.createElement("div");return n.className="playerCard",n.setAttribute("data-id",t),n.innerHTML=`<p class="playerName">${e}</p><div><div class="status-dot"></div><p class="status-message">${r}</p></div>`,r=="ready"&&L(n,"ready"),n}function L(e,t){e.querySelector(".status-dot").classList.add("greenBg"),e.querySelector(".status-message").innerText=t}var P=25,s=Math.sqrt(P),d,f,b,q;function Z(){f=document.querySelector(".tile").clientWidth,d=u.clientWidth,b=(d-s*f)/(s-1),q=f/2}function ee(e){let t=document.createElement("div");return t.className="row-strike",t.style.setProperty("top",`${e}px`),t.style.setProperty("width",`${d}px`),t}function te(e){let t=document.createElement("div");return t.className="column-strike",t.style.setProperty("left",`${e}px`),t.style.setProperty("height",`${d}px`),t}function re(e){let t=document.createElement("div"),r=Math.floor(Math.sqrt(2*Math.pow(d,2))),n=(d-r)/2;t.style.setProperty("transform",`rotate(${e}deg)`),t.style.setProperty("position","absolute"),t.style.setProperty("left",`${d/2}px`),t.style.setProperty("top",`${n}px`);let w=document.createElement("div");return w.className="diagonal-strike",w.style.setProperty("height",`${r}px`),t.appendChild(w),[t,w]}function oe(e){let t=e*f+e*b+q,r=ee(t);u.append(r),r.animate(fe,F)}function ne(e){let t=e*f+e*b+q,r=te(t);u.append(r),r.animate(se,F)}function ie(e){let t;e==0?t=-45:t=45;let[r,n]=re(t);u.append(r),n.animate(se,F)}var fe=[{transform:"scaleX(0)"},{transform:"scaleX(1)"}],se=[{transform:"scaleY(0)"},{transform:"scaleY(1)"}],F={duration:500,easing:"ease-out"};var o={count:0,rows:{},columns:{},diagonals:{0:0,1:0}};for(let e=0;e<s;e++)o.rows[e]=0,o.columns[e]=0;function H(e){let t=parseInt(e.getAttribute("data-index"));ye(t),o.count>=5&&(T.innerText="You",c(y),a.create("completed"))}function ye(e){let t=Math.floor(e/s),r=e%s;o.rows[t]+=1,o.columns[r]+=1,t==r&&(o.diagonals[0]+=1),t+r==s-1&&(o.diagonals[1]+=1),he()}function he(){for(let e=0;e<s;e++)o.rows[e]==s&&(oe(e),delete o.rows[e],o.count+=1),o.columns[e]==s&&(ne(e),delete o.columns[e],o.count+=1),(e==0||e==1)&&o.diagonals[e]==s&&(ie(e),delete o.diagonals[e],o.count+=1)}function O(e){let t=document.createElement("div");return t.className="tile",t.addEventListener("click",e),t}p.addEventListener("click",qe);m.addEventListener("click",be);var I=0,j=!1,xe={approved:Se,joined:ge,allready:we,start:ce,ready:Te,turn:le,choice:Ee,left:Ce,completed:Le,rejected:Pe};function Se({data:e}){a.bindPlayer(e.assignedId),ve(),ae(e.existingPlayers),c(p),Z(),e.existingPlayers.length==0&&c(E)}function ve(){for(let e=0;e<P;e++){let t=O(M);t.setAttribute("data-index",e),grid.appendChild(t)}}function M({target:e}){I++,e.innerText=I,e.setAttribute("data-value",I),e.removeEventListener("click",M),ke()}function ke(){I==25&&(a.create("ready"),W(p)==!1&&l(p))}function ge({data:e}){ae([e.joinedPlayer]),W(m)==!1&&l(m)}function ae(e){e.forEach(t=>{$.appendChild(V(t))})}function we(){c(m)}function ce(){D.forEach(e=>{e.addEventListener("click",R)}),Y.forEach(e=>L(e,"in-game"))}function R({target:e}){if(j){let t=e.getAttribute("data-value");a.create("choice",{choice:t}),e.classList.add("chosen"),e.removeEventListener("click",R),j=!1,H(e),N.classList.remove("turn")}}function Ee({data:e}){let t=C(".tile",{"data-value":e.choice});t.classList.add("chosen"),t.removeEventListener("click",R),H(t)}function Te({data:e}){let t=C("div",{"data-id":e.player});L(t,"ready")}function Ce({data:e}){let t=C(".playerCard",{"data-id":e.player});t&&t.remove()}function Le({data:e}){T.innerText=e.winner.name,c(y)}function le(){j=!0,N.classList.add("turn")}function Pe({data:e}){document.location=document.location.protocol+"//"+document.location.host+`/error?message=${e.message}`}function be(){a.create("start"),ce(),le(),l(m)}function qe(){let e=Array.from(D);for(let t=P-1;t>=0;t--){let r=Q(0,t),n=e[r];e[r]=e[t],e[t]=n,e[t].innerText==""&&M({target:e[t]})}l(p)}var de=xe;var A;function ue(e,t){A=new WebSocket(e),A.addEventListener("open",()=>{a.create("request",{username:t})}),A.addEventListener("message",r=>{let n=JSON.parse(r.data);de[n.event](n)})}function pe(e){A.send(JSON.stringify(e))}var Ie={session:void 0,player:void 0,playerBound:!1,create(e,t){t=this.embedSessionAndPlayer(t);let r;e=="request"?r=new h(t):e=="start"?r=new x(t):e=="ready"?r=new S(t):e=="choice"?r=new v(t):e=="completed"&&(r=new k(t)),pe(r)},bindSession(e){this.session=e},bindPlayer(e){this.player=e,this.playerBound=!0},embedSessionAndPlayer(e){return e=e||{},e.session=this.session,this.playerBound&&(e.from=this.player),e}},a=Ie;c(G);var g=window.location,me=g.pathname.substring(1);a.bindSession(me);var B,_;g.protocol=="https:"?_="wss://"+g.host:_="ws://"+g.host;J.addEventListener("click",Ae);function Ae(){B=K.value,!(B==""||B.length<5)&&(ue(_,B),l(G))}U.innerText=`Code: ${me}`;X.addEventListener("click",({target:e})=>{navigator.clipboard.writeText(g),e.innerText="Copied",setTimeout(()=>{e.innerText="Copy link"},500)});z.addEventListener("click",()=>{l(E)});})();
